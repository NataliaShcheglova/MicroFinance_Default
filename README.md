# Анализ данных микрофинансовой организации и Прогнозирование дефолта 

## Описание задачи 

Организация выдает займы физическим лицам.
На основе информации о ранее выданных организацией займах и данных о клиентах, оставлявших заявки на займ, но в итоге не взявших его по причине отказа финансовой организации или нежеланию самого клиента.

**Необходимо:**

1. Выполнить анализ и охарактеризовать клиентский портфель организации
2. Построить базовую модель прогнозирования банкротства, одобряющую не менее 35% клиентов при банкротстве среди одобренных не выше 15%.
3. Подготовить рекомендации и предложения по изменению признакового пространства, использованию внешних данных и иному развитию базовой модели.

## Описание работы 

**I. Анализ и предобработка данных** 
- Изучена общая информация по датасета loan (выданные займы) и reject (отклоненные займы).
- Выявлен и удалены явные дубликаты (197 и 205 дубликатов в датасете loan и reject соответственно). 
- Выявлен колонки с пропусками, проанализирована природа пропусков. Пропуски заполнены нулевыми значениями для тех столбцов, где количество пропусков было около 1% и более. Для остальных колонок с мизерным количеством пропусков строки с пропусками были удалены. 
- Выявлены и обработан аномалии. Обнаружены строки с бесконечностью в некоторых столбцах (результат деления на ноль), а также строки с отрицательными значениями. Строки, содержащие аномалии удалены, поскольку логично, что сумма кредита или количество дней просрочки не может быть отрицательным или бесконечным числом. 
- Необходимо вернуться к бизнесу и выяснить, по какой причине в датасете появились отрицательные и бесконечные значения. Возможно, причина связана с подходом к расчету или заполнению данных, возможно сложности возникли на этапе выгрузки данных. 
- Построены гистограммы распределения для датасетов, из которх видно, что бОльшая часть данных каждого столбца сконцентрирована в районе нуля. Это хороший показатель, поскольку у большинства клиентов в базе есть активные кредиты, значит они пользуются услугами микрокредитных организаций (что хорошо для бизнеса), также у большинства клиентов отсутсвуют просроченне и невозвращенные кредиты, значит они благонадежны и пр. 
- Некоторые столбцы датасета loan (выданные займы) напоминают распределение Пуассона со скосом влево - то есть имеют концентрацию наибольшего количества значений в районе нуля, а дальше график плавно спадает в правую сторону. В датасете reject (отклоненне займы) данные распределяются более полого. 
- Доля кредитов, взятых за последние 3 месяца, относительно всех кредитов истории `fraction_last_x_3 ` в датасете loan - слабо стремиться к нормальному распределению (без длинных хвостов по краям).
- **Датасет `loan (выданные займы)` сократился на  10 %, датасет `reject (отклоненные займы)` сократился на  14 % в ходе предобработки. Это большая потеря данных. В рамках тестового задания оставим такое сокращение. Для реальной бизнес задачи необходимо вернуться к бизнесу и к DA/DE, кто занимается подготовкой датасета, и выяснить причины, по которым пояавились аномалии в данных, более подробно изучить их природу (формул расчета, методы заполнения дынных, методы сбора инфррмации и пр.), а затем разработать методы восстановления данных, где это возможно**

**II. Клиентский портфель организации**

**<font color="darkcyan">Исходя из данных, представленных в датасете о ранее выданных организацией займах, типичный клиент  организации - это относительно молодые люди в возрасте 28-39 лет, активно пользующиеся микрокредитами и другими видами кредита, и, в большинстве случаев, демонстрирующие дисциплинированное поведение в отношении погашения кредитов.</font>**

**III. Построение и тестирование модели** 

*Результат:* 

<font color="orangered">**Значение F1-beta = 0.61, Precision = 0.36, Recall = 0.64 для наилучшей модели CatBoostClassifier**</font>
- Precision (Точность) равна 0.36. Это означает, что из клиентов, которым были одобрены кредиты, только 36% действительно стали банкротами. В контексте задачи, это может означать, что модель одобряет кредиты слишком часто, и многие из них оказываются ошибочными.

- Recall (Полнота) равна 0.64. Это говорит о том, что модель идентифицировала 64% всех действительных банкротов среди всех банкротов. Думаю, это хорошее значение, так как модель не упустила многих потенциальных банкротов.

- F1-beta равна 0.61. Это говорит о том, что присутствует некоторый баланс между тем, насколько точным и полным является модель.

*Что сделано:*


- **Датасет.** Обучена и протестирована модель на датасете `loan` (Информация о ранее выданных организацией займах). 
- Подготовлены обучающая и тестовая выборки с признаками и целевым прзнаком. 
- Построена и обучена **модель** градиентного бустинга **`CatBoostClassifier`** - она устойчива к переобучению, не требует стандартизации данных и в целом отлично работает с несовершенными данными.
- Подбор гиперпараметров проведен с помощью библиотеки optuna. 

- Использована **метрика `F1-бетта`**, поскольку у нас присутствует дисбаланс классов. Кроме того, в финтех направлении F1-беттамявляются распространеннымимрешением. 
- Значение бета выбрано равное 5 (в метрике F1-бета), поскольку в нашем датасете содержится 72% нулевых значений и всего 28% единиц. Это говорит о несбалансированных данных. Нам требуется больше внимания к полноте (recall), чтобы не упустить важные положительные случаи (дефолты), но при этом не слишком снижать точность, значит выбираем бета > 1.

- Проведена оценка важности признаков с помощью SHAP и feature_importance. Оба инструмента показали схожие результаты. Наиболее значимым признаком стал `overall_worst_overdue_state_12` (около 8.8%). Самыми незначительными признаками являются `ratio_pattern_len_to_pattern_2`, `ratio_pattern_len_to_pattern_4` и `ratio_pattern_len_to_pattern_3`. **Удаление этих признаков ухуджает метрику, потому не трогаем их**. 

- Перед обучением проведена оценка корреляции Пирсона для признаков датасета. Выявлен ряд присзнаков с высокой корреляцией (свыще 96%). **Удаление этих признаков - одного из пары -  ухуджает метрику, потому не трогаем их**. 

**IV.  Рекомендации и предложения**

Подготовлены рекомендации и предлодения по изменению признакового пространства, использованию внешних данных и развитию базовой модели.

